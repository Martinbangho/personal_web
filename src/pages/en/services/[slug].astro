---
import Base from '../../../layouts/Base.astro';
import NavCtas from '../../../components/NavCtas.astro';
import type { SeoInput } from '../../../utils/seo';
import {
  buildProfessionalServiceJsonLd,
  buildWebsiteJsonLd,
  getServiceAlternates,
  getServiceEntry,
  getServiceStaticPaths,
  getServiceUrl,
} from '../../../utils/services';

export async function getStaticPaths() {
  return getServiceStaticPaths('en');
}

const slug = Astro.params.slug!;
const entry = await getServiceEntry('en', slug);

if (!entry) {
  throw new Error(`Service with slug "${slug}" (en) was not found.`);
}

const { Content } = await entry.render();
const alternates = await getServiceAlternates(entry);
const canonicalUrl = getServiceUrl('en', entry.data.entrySlug);

const seo: SeoInput = {
  title: entry.data.seo.title,
  description: entry.data.seo.description,
  canonical: canonicalUrl,
  ogTitle: entry.data.seo.ogTitle ?? entry.data.seo.title,
  ogDescription: entry.data.seo.ogDescription ?? entry.data.seo.description,
  ogUrl: canonicalUrl,
  alternates,
};

const websiteJsonLd = buildWebsiteJsonLd('en');
const professionalServiceJsonLd = await buildProfessionalServiceJsonLd('en');
---
<Base lang="en" seo={seo} navClass="pt-25" navTopClass="pb-25">
  <NavCtas lang="en" />
  <Fragment slot="head">
    <!-- reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/enterprise.js?render=6LeLuxwrAAAAACS4SwjIa4pBGqOty0K_qNOrtHtI"></script>
    <script>
      {`grecaptcha.ready(function () {
  const form = document.getElementById('contact-form');
  if (!form) return;
  form.addEventListener('submit', function (event) {
    event.preventDefault();
    grecaptcha
      .execute('6LeLuxwrAAAAACS4SwjIa4pBGqOty0K_qNOrtHtI', {
        action: 'submit',
      })
      .then(function (token) {
        const responseInput = document.getElementById('recaptchaResponse');
        if (responseInput) {
          responseInput.value = token;
        }
        form.submit();
      });
  });
});`}
    </script>

    <!-- Structured data -->
    <script type="application/ld+json">
      {JSON.stringify(websiteJsonLd)}
    </script>
    <script type="application/ld+json">
      {JSON.stringify(professionalServiceJsonLd)}
    </script>
  </Fragment>
  <main>
    <Content />
  </main>
</Base>
